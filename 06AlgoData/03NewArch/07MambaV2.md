<!--Copyright © ZOMI 适用于[License](https://github.com/Infrasys-AI/AIInfra)版权许可-->

# Mamba-2 架构:从选择性状态空间到结构化对偶性

> Author by: 张嘉瑶


## 引言:寻求后注意力时代的新架构

近年来，尽管 Transformer 架构凭借其卓越的性能主导了深度学习领域，但状态空间模型（SSM）作为一种极具潜力的替代方案，已在中小规模模型上展现出与 Transformer 相媲美甚至超越的性能。Mamba-2 架构的问世，不仅是其前身 Mamba-1 的迭代升级，更是一次深刻的理论与工程范式革新。其核心贡献在于提出了“状态空间对偶性”（State Space Duality, SSD）框架，该框架通过结构化矩阵理论，首次在数学上严谨地统一了状态空间模型与注意力机制这两种看似迥异的序列建模范式。本文旨在对 Mamba-2 进行一次全面而深入的剖析。将首先阐述 SSD 的理论基础，揭示其如何将 SSM 的线性递归模式与类注意力机制的二次矩阵运算模式统一在同一数学框架下。随后，将详细解构 Mamba-2 的具体架构设计，分析其如何通过对模型结构的精巧约束与创新的混合计算算法，实现了训练速度 2-8 倍的大幅提升。此外，还将通过与 Transformer 及 Mamba-1 的深度对比，评估其在计算复杂度、内存消耗、性能表现及适用场景上的差异与权衡。最后，将探讨 Mamba-2 在语言模型之外的广阔应用前景，分析其当前存在的局限性，并展望由 SSD 框架开启的未来研究方向，包括混合架构、硬件协同设计以及全新应用领域的开拓。Mamba-2 的意义远不止于一个更快的模型，它代表了从算法理论到硬件实现协同设计的胜利，为后 Transformer 时代的序列建模研究开辟了全新的道路。

## 理论基石：通过状态空间对偶性统一 SSM 与注意力机制

Mamba-2 的核心创新并非简单的架构微调，而是一次深刻的理论重构。其基石是“状态空间对偶性”（State Space Duality, SSD）框架，该框架不仅解释了 Mamba-1 成功背后的机制，更在根本上弥合了状态空间模型（SSM）与注意力机制之间的理论鸿沟。

### 对偶性原理：殊途同归的两种计算范式

SSD 的核心思想在于，一个特定的序列变换层（即 SSD 层）可以通过两种在数学上完全等价的方式进行计算。这两种计算模式，即线性（SSM）模式和二次（注意力）模式，为模型在不同应用场景（训练与推理）下实现最优效率提供了理论基础 

* 线性（SSM）模式：此模式遵循经典的递归计算形式，其核心状态更新方程为：

$$h_{t} = A_t h_{t-1} + B_t x_t$$
$$y_t = C_t^{\top} h_t$$

其中，$h_t$ 是一个维度为 $N$ 的隐状态。这种模式的巨大优势在于其计算复杂度和内存占用随序列长度 $T$ 呈线性增长（$O(T)$），并且在自回归生成任务中，仅需维持一个大小恒定（$O(N)$）的状态，使其非常适合快速推理 1。这使其在理论上与循环神经网络（RNN）和经典控制理论中的状态空间模型一脉相承 

* 二次（注意力）模式：此模式将整个序列的变换表示为一次大规模的矩阵乘法：

$$y = Mx$$

其中，$M$ 是一个 $T \times T$ 的变换矩阵。这种模式在概念上与注意力机制非常相似，尽管它省去了 Softmax 归一化，并采用了一种不同的掩码机制
。虽然其浮点运算次数（FLOPs）与序列长度呈二次方关系（$O(T^2)$），但它在训练阶段却极具吸引力。其根本原因在于，这种模式的计算完全依赖于矩阵乘法，而现代硬件加速器（如 GPU 和 TPU）中的张量核心（Tensor Cores）正是为执行大规模矩阵乘法而高度优化的。

<div align="center">
  <img src="./images/structured_masked_attention.jpg" alt="img" />
  <figcaption><strong>Structure Masked Attention</strong></figcaption>
</div>



这一对偶性的提出，其动机源于 Mamba-1 所面临的两个根本性问题。其一，是概念层面的困惑：SSM 与注意力机制在功能上都用于序列信息整合，但其数学形式和直观感受却大相径庭，两者之间是否存在更深层次的联系？其二，是计算层面的挑战：尽管 Mamba-1 的扫描算法在理论上具有优越的线性复杂度，但在实际训练中，其硬件效率远低于高度优化的注意力机制。由于其定制化的 CUDA 核函数无法充分利用 GPU 为矩阵乘法设计的专用计算单元，导致其在训练时通常比同等规模的 Transformer 更慢。

Mamba-2 的诞生，标志着神经网络架构的设计思路发生了一次关键转变，从单纯追求算法的理论最优，转向了算法与硬件协同设计的全新范式。Mamba-1 的困境揭示了一个深刻的现实：在现代计算体系中，渐进复杂度并非衡量效率的唯一标准，与硬件特性的契合度同样至关重要。Mamba-2 的开发者没有选择在 Mamba-1 的定制核上进行渐进式优化，而是从第一性原理出发，对模型进行了根本性的重新理论化。他们提出的 SSD 框架，其核心目标就是将 SSM 的核心运算重塑为硬件原生支持的矩阵乘法形式。这意味着，模型的数学形式本身是为了迁就和最大化利用现有硬件的能力而设计的。因此，Mamba-2 不仅是一个更优秀的算法，更是硬件-软件协同设计理念的一次成功实践，为未来 AI 架构的研究指明了方向：理论的优雅必须与计算的现实相结合，才能催生真正的突破。

SSD 框架的严谨性建立在对结构化矩阵（structured matrices）这一成熟数学领域的深刻理解之上。其核心洞见在于，许多序列模型本质上都可以被视为一种“矩阵混合器”（matrix mixer），即输入序列 $X$ 到输出序列 $Y$ 的变换可以表示为 $Y = M(X) \cdot X$，而模型的所有特性都蕴含在变换矩阵 $M$ 的结构之中。


该理论框架的一项关键定理是：状态空间模型（SSM）在数学上等价于一类被称为“半可分矩阵”（semiseparable matrices）的结构化矩阵。这类矩阵的一个显著特性是，其对角线以下的任意子矩阵都具有低秩（low-rank）结构。正是这种内在的结构冗余，使得对这类矩阵的乘法运算可以被极大地加速，而无需显式地构建整个 $T \times T$ 矩阵。

<div align="center">
  <img src="./images/MambaV2-1.png" alt="img" />
  <figcaption><strong>半可分矩阵对角线上的所有子矩阵都是低秩的</strong></figcaption>
</div>

>所有用于计算状态空间模型的算法都可以看作是半可分矩阵上的结构化矩阵乘法算法。

基于这一深刻联系，Mamba-2 的对偶性得到了一个极其优雅的数学解释：
* 线性 SSM 模式，本质上是一种针对半可分矩阵的结构化矩阵乘法算法。它利用矩阵的低秩特性，通过递归方式逐步计算结果，从而避免了构建和存储整个稠密矩阵，实现了线性的时间与空间复杂度 
* 二次注意力模式，则对应于一种朴素的矩阵乘法算法。它首先显式地构建出完整的 $T \times T$ 变换矩阵 $M$，然后再与输入向量 $X$ 相乘 

因此，SSD 的对偶性并非两种不同的模型，而是针对同一个底层数学对象（半可分矩阵）的两种不同计算策略。这一源于数值代数领域的经典结论，为 Mamba-2 的对偶性提供了坚实的理论证明，并将其置于一个更广阔、更严谨的数学体系之中。

SSD 框架不仅连接了 SSM 与结构化矩阵，也清晰地揭示了其与线性注意力的关系。Mamba-2 的二次模式可以被看作是线性注意力的一种推广。具体而言，如果将状态转移参数 $a_t$ 在所有时间步上都设为 1，那么 SSD 的二次计算公式将退化为标准的因果线性注意力（causal linear attention）。

Mamba-2 与标准注意力机制的关键区别，在于其继承自 Mamba-1 的“选择性”（selectivity）机制。该机制允许模型的参数 $(A, B, C)$ 依赖于输入数据，从而实现对信息的动态过滤。在二次模式的视角下，这种选择性体现在一个与输入相关的乘法掩码矩阵 $L$ 上 1。该矩阵由状态转移参数 $A$ 派生而来，其元素 $a_{i:j}^\times = a_i \cdots a_{j+1}$ 作用于注意力得分上，相当于一种输入依赖的相对位置编码。正是这个机制，使得模型能够根据当前上下文动态地决定是“记住”还是“遗忘”历史信息，从而在类注意力的框架内实现了 Mamba 标志性的选择能力。

## Mamba-2 架构：从理论到实现

Mamba-2 的架构设计，是将第一部分中阐述的深刻理论转化为具体、高效工程实现的典范。其每一处改动都服务于一个共同的目标：在保持 SSM 核心优势的同时，最大化地利用现代硬件的计算能力。

### SSD 层：一个经过精炼和约束的选择性 SSM

Mamba-2 的核心是 SSD 层，它在 Mamba-1 的 S6 层基础上进行了两项关键且相互关联的结构性简化。

* 标量乘以单位矩阵（Scalar-Times-Identity）的 $A$ 矩阵：这是 Mamba-2 与 Mamba-1 最本质的架构区别。
  * 在 Mamba-1（S6）中，$A$ 矩阵被设计为对角结构，意味着状态向量 $h$ 的 $N$ 个维度各自拥有独立的递归动态参数，这提供了高度的灵活性 
  * 在 Mamba-2（SSD）中，$A$ 矩阵被施加了更严格的标量乘以单位矩阵约束。在任意时间步 $t$，整个 $N \times N$ 的 $A$ 矩阵所有对角元素都必须是同一个标量值 $a_t$。
  * 这一约束的直接后果是一种深度的权重绑定（weight tying）。它强制状态空间的所有 $N$ 个维度共享完全相同的递归动态。这种看似牺牲了模型表达能力的设计，却是解锁状态空间对偶性的关键一步，因为只有当所有状态维度的衰减/增长率相同时，整个计算过程才能被优雅地表示为二次（注意力）模式。
* 多头 SSM（$P > 1$）：
 * Mamba-1 的头维度（head dimension）$P=1$，即每个通道（channel）都由一个独立的 SSM 进行控制。
 * Mamba-2 则采用了更大的头维度（默认 $P=64$），即一组 SSM 参数 $(a_t, B_t, C_t)$ 会同时作用于一个包含 $P$ 个通道的通道组。这种设计不仅与多头注意力机制的结构更为相似，也是一项出于效率考量的选择。
 
 这两项约束共同揭示了 Mamba-2 设计哲学中的一个核心权衡：用细粒度的参数表达能力换取一个更大、计算更高效的状态空间。Mamba-1 的对角矩阵 $A$ 允许其 $N=16$ 的每个状态维度学习独特的衰减率，这在参数层面具有很强的表达力。相比之下，Mamba-2 的标量矩阵 $A$ 强制所有状态维度共享同一个衰减率，显著降低了参数层面的灵活性。然而，正是这一“牺牲”，换来了将模型计算重铸为矩阵乘法的能力。由此带来的训练速度提升是如此巨大，以至于 Mamba-2 可以在几乎不增加甚至减少实际运行时间的情况下，将状态维度 $N$ 扩展到 64、128 甚至 256 5。模型的容量因此发生了战略性转移：从拥有 16 个“聪明”且独立的“神经元”，转变为拥有 128 个“简单”但协同工作的“神经元”。事实证明，状态空间容量的整体扩张，足以弥补甚至超越单个维度灵活性的损失，尤其是在需要大量记忆容量的复杂任务（如多查询关联回忆 MQAR）上，Mamba-2 的性能远超 Mamba-1。

 ### SSD 算法：集两家之长的混合计算模式

面对线性模式（低 FLOPs，低硬件利用率）和二次模式（高硬件利用率，高 FLOPs）之间的两难，Mamba-2 引入了创新的 SSD 算法，巧妙地结合了两种模式的优点 。

<div align="center">
  <img src="./images/ssd_algorithm.png" alt="img" />
  <figcaption><strong>SSD 算法</strong></figcaption>
</div>


该算法是一种“分块”（chunkwise）或“块分解”（block decomposition）的混合策略 

1. 序列分区：首先，将长度为 $T$ 的输入序列分割成若干个更小的块（chunks），例如每个块的长度为 $Q$。
2. 块内计算（二次模式）：在每个块的内部，模型并行地使用硬件效率极高的二次（类注意力）模式进行计算。这可以被理解为计算每个块在初始状态为零时的局部输出。
3. 块间通信（线性模式）：一个块计算得到的最终隐状态，将作为下一个块的初始隐状态被传递下去。这个状态传递的过程是在 $T/Q$ 个块之间进行的线性递归。

通过这种方式，SSD 算法在宏观上保持了与 SSM 模式相同的、高效的 $O(TN^2)$ 级别的 FLOPs 计数，同时在微观上将绝大部分计算任务都转换为了硬件友好的矩阵乘法。这正是 Mamba-2 能够实现相比 Mamba-1 训练速度提升 2-8 倍的直接原因。

### 架构简化与并行化设计

除了核心的 SSD 层和算法，Mamba-2 还在整体块结构上进行了简化，以更好地支持大规模并行训练。
* 并行化参数投影：在 Mamba-2 中，用于生成输入依赖的 SSM 参数 $(A, B, C)$ 的线性投影层，与用于主干路径的投影层并行放置，而非 Mamba-1 中的串行结构。这一改动使得模型块的结构更简洁，更接近于标准 Transformer 块，从而更容易应用张量并行（Tensor Parallelism, TP）等模型并行技术。

<div align="center">
  <img src="./images/mamba_tp.png" alt="img" />
  <figcaption><strong>张量并行</strong></figcaption>
</div>

* 对张量与序列并行的友好支持：Mamba-2 的整体设计，特别是 SSD 算法的块状结构，使其对高级并行策略天然友好。论文中提到，并行化的投影设计减少了张量并行所需的通信同步点。更重要的是，SSD 的块分解算法天然地支持序列并行（Sequence Parallelism, SP），即可以将序列的不同块分配到不同的 GPU 上计算，并通过显式的状态传递在 GPU 之间进行通信 。这种对大规模并行训练的深度优化，是 Mamba-2 能够扩展到数十亿甚至更大参数规模的关键。

<div align="center">
  <img src="./images/mamba_cp.png" alt="img" />
  <figcaption><strong>序列并行</strong></figcaption>
</div>


## 全面对比：Mamba-2 vs. Transformer 与 Mamba-1

为了准确评估 Mamba-2 的地位，必须将其置于现有主流架构的坐标系中进行多维度比较。本节将从计算复杂度、性能表现和架构特性三个方面，深入剖析 Mamba-2 相对于其核心竞品（Transformer）和直接前身（Mamba-1）的优劣势。

### 计算复杂度与内存占用：长序列处理的绝对优势

计算效率是 SSM 系列模型的核心卖点，Mamba-2 在继承并优化了这一优势。
* 渐进复杂度分析：
  * Transformer：其核心自注意力机制的计算和内存复杂度均与序列长度 $T$ 呈二次方关系，即 $O(T^2)$ 。这意味着当序列长度翻倍时，计算成本和内存需求会增至四倍。在推理阶段，虽然每个新 token 的生成是线性的，但需要维护一个随上下文增长而线性增大的键值缓存（KV Cache），其大小为 $O(T)$。
  * Mamba-2：得益于 SSD 算法，其训练复杂度与序列长度 $T$ 呈线性关系，具体为 $O(TN^2)$，其中状态维度 $N$ 相对于 $T$ 是一个常数。在推理阶段，Mamba-2 仅需维持一个大小恒为 $O(N)$ 的状态，与序列长度完全无关，实现了真正的常数空间消耗。

* 实际影响：理论上的复杂度差异在处理长序列时会急剧放大。对于诸如处理整本书籍、分析基因组数据或理解小时级视频等任务，Transformer 的二次方瓶颈使其变得不切实际，往往会导致内存溢出或无法承受的计算时间 。而 Mamba-2 的线性扩展能力使其能够轻松应对这些百万 token 级别的超长序列任务，展现出压倒性的优势。

下表直观地总结了三者在关键指标上的差异。

表 1: 架构与复杂度对比

| 特性 | Transformer (Attention) | Mamba-1 (S6) | Mamba-2 (SSD) |
| :---: | :---: | :---: | :---: |
| 训练复杂度 | $ O(T^{2}N) $ | $ O(TN^{2}) $ | $ O(TN^{2}) $ |
| 推理复杂度 (每 token) | $ O(T) $ | $ O(1) $ | $ O(1) $ |
| 训练内存 | $ O(T^{2}) $ | $ O(TN) $ | $ O(TN) $ |
| 推理状态大小 | $ O(T) $ (KV Cache) | $ O(N) $ | $ O(N) $ |
| 核心硬件原语 | 矩阵乘法 | 定制扫描核 | 矩阵乘法 |
| A 矩阵结构 | 不适用 | 对角矩阵 | 标量乘以单位矩阵 |
| 状态维度 (N) | 不适用 | 通常较小 (如 16) | 较大 (如 64 - 256+) |
| 并行化友好度 | 高 (TP, DP) | 中等 | 非常高 (TP, SP) |

### 性能与表达能力：一个微妙的权衡

虽然 Mamba-2 在效率上优势显著，但在模型性能和表达能力上，与 Transformer 的比较呈现出更为复杂的图景。
* 语言建模任务上的竞争力：在中小规模（数十亿参数级别）的语言建模任务上，大量实验证明 Mamba-2 的性能可以与经过精心调优的 Transformer 架构（如 Pythia）相媲美，甚至在某些情况下实现超越 。一个引人注目的结果是，一个 27 亿参数的 Mamba-2 模型在标准下游评测中的表现，超过了一个 69 亿参数的 Pythia 模型，显示出其优越的数据效率和扩展潜力。

* 关联回忆能力的差距：然而，一系列研究也揭示了 Mamba 系列模型的一个潜在短板。在一些需要精确、远距离、无固定模式的信息检索或“复制”的合成任务中（如关联回忆），Transformer 的表现通常优于 Mamba 模型 14。这背后的理论原因是，Mamba 有限的、固定大小的状态 $N$ 对其记忆容量构成了理论上限，而 Transformer 的 KV 缓存机制则允许其存储和访问整个历史上下文，记忆容量几乎是无限的。

* 内在的非对称偏好：近期的研究进一步发现，Mamba 架构（包括 Mamba-2）在其 SSM 模块之前的非线性卷积层引入了一种内在的“非对称偏好”（asymmetry bias）。这使得模型在处理需要识别对称模式的任务时（例如，判断一个序列是否是另一个序列的逆序）表现不佳 。这揭示了两种架构在信息处理机制上的根本差异，而不仅仅是计算效率的不同。

### 从 Mamba-1 到 Mamba-2 的飞跃

相较于其直接前身，Mamba-2 实现了全方位的超越，使其成为一个真正意义上的换代产品。

* 训练速度：这是最显著的改进。由于采用了基于矩阵乘法的 SSD 算法，Mamba-2 的训练速度比使用定制扫描核的 Mamba-1 快了 2 到 8 倍，且序列越长，优势越明显。
* 更大的状态维度：Mamba-2 的计算效率允许其在不牺牲速度的前提下，使用远大于 Mamba-1 的状态维度 $N$（通常是 8 倍或更多） 7。这一改变直接转化为在需要大容量记忆的困难任务（如多查询关联回忆 MQAR）上的性能提升，Mamba-2 在这些任务上显著优于 Mamba-1。
* 帕累托最优：在模型扩展法则（scaling laws）的研究中，Mamba-2 被证明在性能-效率曲线上对 Mamba-1 和 Transformer++架构构成了“帕累托最优”（Pareto dominates）。这意味着，在消耗相同训练计算资源（以实际运行时间衡量）的情况下，Mamba-2 能够达到更低的困惑度（即更好的性能）。


<div align="center">
  <img src="./images/pile_8k_mamba2.png" alt="img" />
</div>




## 实验验证与性能分析

理论的优雅和架构的精巧最终需要通过严格的实验数据来验证。Mamba-2 在多个基准测试中展现了其强大的实力。

### 语言建模基准测试

Mamba-2 的语言建模能力主要通过在大型、多样化的语料库（如 The Pile）上进行预训练，并与公认的开源基线模型进行比较来评估 。   

* 实验设置：研究者们训练了一系列不同规模的 Mamba-2 模型，并将其与参数量相近的 Mamba-1 和 Pythia（一个强大的 Transformer 基线）模型在相同的 3000 亿 token 数据上进行训练和评估。

* 核心结果：

  * 在同等参数规模下（约 27-28 亿），Mamba-2 在多项下游任务评测中全面优于 Mamba-1 和 Pythia 。   

  * 在广泛使用的 MMLU 基准测试中，27 亿参数的 Mamba-2 取得了 39.6%的准确率，高于 Mamba-1 的 38.5%和 Pythia-2.8B 的 36.5% 。   

  * 更令人印象深刻的是，27 亿参数的 Mamba-2 的表现甚至超过了参数量是其两倍多的 Pythia-6.9B 模型 。   

  * 在长上下文（8K）语言建模任务中，Mamba-2 的困惑度为 8.5，优于同类 Transformer 的 9.1，证明了其在长距离依赖建模上的优势 。   




<div align="center">
  <img src="./images/blog_lm_downstream.png" alt="img" />
  <figcaption><strong>对基于 Pile 训练的开源模型进行标准下游评估</strong></figcaption>
</div>



### 长上下文与合成任务性能

除了标准的语言建模任务，Mamba-2 还在专门测试长程依赖和记忆能力的合成任务上进行了评估。
* 多查询关联回忆 (MQAR)：这是一个旨在严格测试模型从长上下文中检索多个键值对能力的合成任务。实验表明，Mamba-2 之所以在该任务上远超 Mamba-1，其核心原因正是其高效的计算架构允许使用更大的状态维度 $N$，从而提供了更大的“工作记忆”空间来存储和检索信息。


<div align="center">
  <img src="./images/multi-query-associative-recall.jpg" alt="img" />
  <figcaption><strong>多查询关联回忆 (MQAR)</strong></figcaption>
</div>



* 计算效率基准：在与业界顶级的优化注意力实现（如 FlashAttention-2）的直接速度对比中，Mamba-2 的 SSD 实现展现了其在长序列上的优势。两者的速度“交叉点”大约出现在序列长度为 2000 时，即当序列长度超过 2K，Mamba-2 开始比 FlashAttention-2 更快。而在序列长度达到 16K 时，SSD 的速度是 FlashAttention-2 的 6 倍。这为从业者在选择模型时提供了一个非常具体的、有实践指导意义的参考。


<div align="center">
  <img src="./images/efficiency_bench.jpg" alt="img" />
  <figcaption><strong>计算效率基准</strong></figcaption>
</div>



## 扩展的生态系统：应用、局限与未来展望

Mamba-2 的影响力已迅速超越了语言建模领域，其独特的性能特征使其成为解决各类长序列问题的有力工具。然而，作为一个新兴架构，其局限性也正被逐步揭示。

### 超越语言：作为通用序列建模器的 Mamba-2

Mamba-2 的线性扩展能力使其成为那些因 Transformer 计算瓶颈而发展受限的领域的理想选择，并迅速催生了一批新的领域基础模型。

* 计算病理学：Mamba2MIL 模型利用 SSD 来处理由数千个图块（patches）组成的“全切片图像”（WSI）序列，实现了对病理图像的高效分析。
* 计算机视觉：Visual State Space Duality (VSSD) 模型将 Mamba-2 的思想适配于非因果的视觉任务，在图像分类、目标检测和语义分割等任务上超越了其他基于 SSM 的模型 。VAMBA 模型则利用 Mamba-2 模块，在单张 GPU 上成功编码超过 1024 帧的视频序列，同时将内存占用降低了 50%，这是传统 Transformer 架构无法企及的。
* 基因组学与生物信息学：SC-MAMBA2 是一个拥有超过 6.25 亿参数的单细胞转录组学基础模型。它能够处理包含超过 6 万个基因的完整基因序列，其处理序列的长度远超现有注意力模型的能力范围，为理解复杂的生物系统开辟了新途径。
* 语音与多模态：在语音分离（Dual-path Mamba） 和多模态大模型（ML-Mamba） 等领域，Mamba-2 同样展现出其作为高效序列编码器的巨大潜力。

Mamba-2 的出现，可能预示着 AI 模型生态的一次重要分化。它的核心价值或许并非在所有方面彻底取代 Transformer，尤其是在以对话式 AI 为代表的、对极强上下文推理能力要求严苛的核心领域。相反，其真正的颠覆性影响在于解锁了那些因序列过长而长期被 AI 技术拒之门外的全新应用领域。Transformer 的二次方复杂度是处理基因组、长视频、高分辨率医学影像等超长序列数据时一道不可逾越的“计算墙”。Mamba-2 的线性扩展能力则直接推倒了这堵墙。因此，我们可以预见一个 AI 模型分工协作的未来：千亿甚至万亿参数的 Transformer 继续在通用认知和对话领域深耕，而以 Mamba-2 为代表的线性复杂度架构，则将成为科学计算、工程模拟、长媒体分析等领域的首选基础模型。Mamba-2 的遗产，可能就是它在这些新领域引发的 AI 应用“寒武纪大爆发”。


### 已识别的局限性与架构约束

随着研究的深入，学术界也对 Mamba 架构的内在局限性有了更清晰的认识。

* 记忆与检索能力的权衡：如前文所述，尽管 Mamba-2 在许多任务上表现优异，但在需要精确、灵活的上下文学习和信息检索的任务上，它与 Transformer 之间仍存在性能差距 。其恒定大小的状态空间，在带来效率的同时，也成为了其实现完美信息回忆的瓶颈 。   

* 结构性偏好：Mamba 架构中的非线性卷积层引入的“非对称偏好”是一个根本性的结构特征，这限制了其处理对称性问题的能力 。这表明模型的某些行为是由其内在结构决定的，难以仅通过扩大规模或增加数据来完全克服。   

* 完美复制的代价：理论分析指出，如果要求一个 Mamba 类的模型能够完美地执行“复制”操作（即无损地从上下文中拷贝信息），其状态空间的大小可能需要随输入序列长度线性增长。但这将使其丧失最核心的计算效率优势，使其总成本与 Transformer 相当 。这揭示了在当前 SSM 框架下，极致效率与某些高级推理能力之间可能存在一种根本性的权衡。

### 序列建模的未来：后 Transformer 时代？

Mamba-2 及其背后的 SSD 框架，为序列建模的未来发展描绘了激动人心的蓝图。

* 混合架构的兴起：SSD 框架在理论上统一了 SSM 和注意力，为构建两者的混合模型提供了坚实的基础。未来的主流架构可能不再是“纯粹”的 SSM 或 Transformer，而是能够根据任务需求或上下文动态地结合两者优势的智能混合体 。例如，TransMamba 模型就尝试在一个统一的参数空间内，根据序列长度动态地在注意力机制和 SSM 机制之间切换 。   

* SSD 框架开启的新研究方向：Mamba-2 的成功为未来研究开辟了诸多激动人心的方向 ：   

  * 更优化的算法：从丰富的结构化矩阵文献中汲取灵感，开发更高效的计算算法。
  * 动态与自适应架构：设计能够学习何时、何处使用 SSM 模式或注意力模式的动态网络。
  * 模型可解释性：利用对偶性，尝试从注意力的视角来理解 SSM 的行为，反之亦然，从而为深度模型的“黑箱”问题提供新的见解。
  * 下一代硬件协同设计：Mamba-2 的成功证明了算法与硬件协同设计的巨大潜力。未来的研究可以进一步探索为结构化矩阵运算专门优化的新型计算硬件，开启新一轮的创新循环。


Mamba-2 的问世是序列建模领域的一个里程碑事件。它远非一次简单的模型迭代，而是一场集深刻理论洞见、精巧架构设计与卓越工程实现于一体的范式革命。其核心贡献可归结为三个层面：

首先，在理论层面，Mamba-2 通过“状态空间对偶性”（SSD）框架，利用结构化矩阵的语言，首次在数学上严谨地统一了状态空间模型（SSM）与注意力机制，结束了两者长期以来在理论上的割裂状态。


<div align="center">
  <img src="./images/ssd_venn.png" alt="img" />
  <figcaption><strong>SSD 框架（红色、蓝色）：状态空间模型（即半可分矩阵）和结构化掩码注意力机制概括了大类高效序列模型。它们的交集就是 SSD 模型（紫色）</strong></figcaption>
</div>




其次，在工程层面，Mamba-2 是硬件-软件协同设计理念的典范。它没有固守于理论上最优但硬件效率低下的算法，而是通过对模型结构的战略性约束，将其核心计算重塑为现代加速器高度优化的矩阵乘法，从而实现了 2-8 倍的惊人训练加速。

最后，在应用层面，Mamba-2 的线性计算和内存扩展能力，使其成为解锁全新应用领域的关键。它为基因组学、长视频理解、计算病理学等过去受限于 Transformer 计算瓶颈的领域，提供了第一个真正实用且强大的基础模型选项。

综上所述，Mamba-2 不仅在性能和效率上为序列建模设立了新的标杆，更重要的是，它通过统一的理论框架和对计算本质的深刻洞察，为整个领域的发展指明了一条通往更高效、更可扩展、更通用人工智能的全新路径。它已经不可逆转地改变了序列建模的未来格局。

## 参考文献

* State Space Duality (Mamba-2) Part I - The Model | Goomba Lab,  2025, https://goombalab.github.io/blog/2024/mamba2-part1-model/#the-mamba-2-architecture
* State Space Duality (Mamba-2) Part I - The Model | Tri Dao,  https://tridao.me/blog/2024/mamba2-part1-model/
* State Space Duality (Mamba-2) Part II - The Theory | Tri Dao,  https://tridao.me/blog/2024/mamba2-part2-theory/
* Spatial-Mamba: effective visual state space models via structure-aware state fusion - ICLR Proceedings, https://proceedings.iclr.cc/paper_files/paper/2025/file/b7216f4a324864e1f592c18de4d83d10-Paper-Conference.pdf
* Mamba2: The Hardware-Algorithm Co-Design That Unified Attention and State Space Models | by Daniel Stallworth | Sep, 2025 | Medium,  https://medium.com/@danieljsmit/mamba2-the-hardware-algorithm-co-design-that-unified-attention-and-state-space-models-77856d2ac4f4
* Transformers are SSMs: Generalized Models and Efficient Algorithms Through Structured State Space Duality (2405.21060v1) - Emergent Mind,  https://www.emergentmind.com/papers/2405.21060
* Transformers are SSMs: Generalized Models and Efficient Algorithms Through Structured State Space Duality, https://openreview.net/pdf/54bf495d93336f1f195f264c1b6c2805169b3492.pdf
* Transformers are SSMs: Generalized Models and Efficient Algorithms Through Structured State Space Duality - arXiv, https://arxiv.org/abs/2405.21060
* Mamba 2 | PDF | Matrix (Mathematics) | Tensor - Scribd,  https://www.scribd.com/document/748683510/mamba2
