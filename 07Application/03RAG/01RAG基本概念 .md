# RAG 基础概念

> Author by: 曾薇敏, ZOMI

**检索增强生成**（Retrieval-Augmented Generation, RAG）是一种优化大型语言模型（LLMs）输出的机制，其核心概念在于通过利用外部知识数据库来增强 LLMs 的功能。也就是说，为了解决纯参数化模型的局限，可以采取半参数化方法，将非参数化的语料库数据库与参数化模型相结合。RAG 旨在解决现有 LLMs 固有的局限性，例如“幻觉”问题、知识更新困难（由于 LLM 参数存储的知识是静态的，且再训练成本高昂），以及缺乏领域特定专业知识的挑战。RAG 能够将检索到的权威的、相关的外部事实信息提供给 LLMs，从而使其响应更加准确、实时和可信赖。

单独依靠 LLMs 输出存在一些局限：

- **知识的局限性**：模型知识的广度获取严重依赖于训练数据集的广度，目前市面上大多数的大模型的训练集来源于网络公开数据集，对于一些内部数据、特定领域或高度专业化的知识，无从学习。

- **知识的滞后性**：模型知识的获取是通过使用训练数据集训练获取的，模型训练后产生的一些新知识，模型是无法学习的，而大模型训练成本极高，不可能经常为了弥补知识而进行模型训练。

- **幻觉问题**：所有的 AI 模型的底层原理都是基于数学概率，其模型输出实质上是一系列数值运算，大模型也不例外，所以它有时候会一本正经地胡说八道，尤其是在大模型自身不具备某一方面的知识或不擅长的场景。而这种幻觉问题的区分是比较困难的，因为它要求使用者自身具备相应领域的知识。

- **数据安全性**：对于企业来说，数据安全至关重要，没有企业愿意承担数据泄露的风险，将自身的私域数据上传第三方平台进行训练。这也导致完全依赖通用大模型自身能力的应用方案不得不在数据安全和效果方面进行取舍。

RAG 主要解决了现有 LLMs 的固有局限性，从而提供了显著优势。

- **减少幻觉**：LLMs 可能会生成“幻觉”内容，RAG 通过将 LLM 导向权威的、预先确定的知识来源来对抗这些挑战。

- **成本效益**：因为引入新数据比重新训练基础模型更为经济

- **提供最新的信息**：开发者可以将 LLM 连接至实时更新的数据源（如新闻网站），以保证信息的时效性。

- **标明来源引用**：增强用户的信任和对生成内容的信赖。RAG 访问的外部来源对用户是透明的，这弥补了基础模型知识的“黑箱”特性。

- **适应不同场景**：通过控制和更改 LLM 的信息来源，可以使大模型适应不断变化的需求或跨功能使用。

- **突破上下文限制**：通过检索只提取与问题最相关的片段作为上下文，解决了传统大模型直接处理超长文档（如数百页报告）时的上下文窗口限制和信息稀释问题。

一个典型的 RAG 系统由三大核心模块构成：**检索器（retriever）、生成器（generator）和检索融合（retrieval fusions）**。其工作**流程**首先是检索阶段，即当输入一个查询 $q$ 时，检索器会同步接收该查询。检索器的任务是根据查询 $q$ 的向量嵌入，通过近似最近邻（ANN）搜索技术，从外部知识库 $\boldsymbol{D}$（通常包含经分块和编码的文档块 $c_i$）中高效地检索出最相关的 $k$ 个知识块 $R_q={r_1, r_2, \dots, r_k}$。检索器设计中的关键挑战在于平衡检索效率（即获取相关信息的速度）与检索质量（即检索信息的关联性）。随后，检索融合模块负责将检索到的知识 $R_q$ 整合到生成过程中，以增强生成器的性能。融合技术主要分为三类：基于查询的融合（如将检索到的文本或特征与输入查询进行拼接以增强输入），基于 Logits 的融合（如在输出层聚合检索和输出的 Logits 来校准最终预测），以及潜在融合（如利用跨注意力机制或加权加法将检索表示直接融入生成器的隐藏状态）。最终，生成器模块（可以是预训练或微调的大型语言模型）利用经过融合的输入和检索信息，输出最终的答案 $answer$。RAG 的整体流程体现了信息检索与内容生成之间的有效协同，使得 LLM 能够在不进行昂贵再训练的前提下，动态地利用最新的或特定领域的外部知识。

RAG 与语义搜索（Semantic Search）存在协同关系但概念不同。语义搜索技术旨在通过扫描大型、异构的数据库来更准确地检索数据，从而能够增强 RAG 的结果质量。传统的关键词搜索在知识密集型任务中效果有限，而语义搜索则通过将用户查询映射到相关文档，返回特定的、语义相关的文本片段，而非仅仅是搜索结果。因此，语义搜索技术有助于解决大规模知识库中的语境检索难题。此外，语义搜索技术还能自动化处理 RAG 流程中的知识库准备工作，例如文档分块和词嵌入，并生成按相关性排序的内容，从而最大化 RAG 有效载荷的质量。

RAG 技术适用于广泛的场景，凡是需要利用外部、最新或专业知识来校准生成模型输出的领域均可应用。典型的应用场景包括：在**客户体验**领域，RAG 可用于构建下一代智能聊天机器人和虚拟代理，能够基于个性化数据提供回复并执行操作；在企业内部，RAG 常被应用于**人力资源问答**，例如检索员工的休假记录和相应的政策文件。此外，RAG 模型在**数字劳动力**自动化方面也扮演重要角色，它可用于加速法律、采购和财务等流程中的合同或发票起草与修改。在**科学、工程和研究**领域，RAG 模型能协助提出复杂问题的创新解决方案，例如生成具有预期特性的分子结构或合成医学图像。

## 参考资料：

https://aws.amazon.com/what-is/retrieval-augmented-generation/

[What is RAG (Retrieval Augmented Generation)? | IBM](https://www.ibm.com/think/topics/retrieval-augmented-generation)

[一文详谈 RAG 优化方案与实践](https://mp.weixin.qq.com/s?search_click_id=5633330201724964586-1762173289103-9098296259&__biz=MzIzOTU0NTQ0MA==&mid=2247538935&idx=1&sn=c61995829543a0873b8390eeb92f3291&chksm=e81370bc1a1f325ce1b9b6e2562262b9cd5849b43a3c1aaeda6bc11df079655feeb246136781&scene=7&subscene=10000&sessionid=1762614400&clicktime=1762173289&enterid=1762173289&ascene=65&fasttmpl_type=0&fasttmpl_fullversion=7986945-zh_CN-zip&fasttmpl_flag=0&realreporttime=1762618972184#rd)

Wu, Shangyu, et al. "Retrieval-augmented generation for natural language processing: A survey." *arXiv preprint arXiv:2407.13193* (2024).

 
